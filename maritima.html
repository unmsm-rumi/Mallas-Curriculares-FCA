<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
   <style>
    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        overflow-y: auto;
        overflow-x: hidden;
        background-color: #f5fbfb;
    }

    .panel-superior {
        max-width: 1200px;
        margin: 20px auto;
        display: flex;
        gap: 40px;
        justify-content: center;
        flex-wrap: wrap;
        align-items: center;
    }

    .progreso {
        background-color: #e6f7f7;
        border: 1px solid #9adede;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        min-width: 250px;
        max-width: 520px;
        flex: 1 1 300px;
    }

    .barra-contenedor {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 10px 0;
    }

    .barra-externa {
        flex: 1;
        width: 100%;
        background-color: #cceeee;
        border-radius: 10px;
        overflow: hidden;
        height: 16px;
        margin: 8px 0;
    }

    .barra-interna {
        height: 100%;
        background-color: #1bbfbf;
        width: 0%;
        transition: width 0.4s ease;
    }

    .porcentaje {
        font-weight: bold;
        color: #0a8f8f;
    }

    .progreso button {
        padding: 10px 20px;
        background-color: #2ecfcf;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
        transition: background-color 0.3s ease;
    }

    .progreso button:hover {
        background-color: #17a2a2;
    }

    .malla-container {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        padding: 20px;
        padding-bottom: 20px;
        max-width: 150vw;
        box-sizing: border-box;
    }

    .ciclo {
        width: 280px;
        max-width: 320px;
        min-width: 320px;
        flex-shrink: 0;
        background-color: #e6f7f7;
        border-radius: 12px;
        padding: 15px;
        border: 1px solid #9adede;
    }

    .ciclo h2 {
        color: #0a8f8f;
        text-align: center;
        font-size: 18px;
        margin-bottom: 15px;
    }

    .curso {
        width: 100%;
        box-sizing: border-box;
        position: relative;
        padding: 10px;
        background-color: #f2fbfb;
        border-radius: 10px;
        border: 1px solid #b3e5e5;
        cursor: default;
        transition: all 0.3s ease;
        text-align: center;
        margin-bottom: 10px;
        opacity: 0.6;
        color: #356e6e;
    }

    .curso.activo {
        background-color: #c8f0f0;
        border-color: #0a8f8f;
        color: #0a8f8f;
        font-weight: bold;
        cursor: pointer;
        opacity: 1;
    }

    .curso.tildado {
        text-decoration: line-through;
        background-color: #d9f2f2;
        color: #7a9a9a;
        opacity: 1;
        cursor: pointer;
    }

    .curso.electiva {
        border: 2px dashed #4fd1d1;
        background-color: #e6f7f7;
    }

    .tooltip {
        position: absolute;
        bottom: 110%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #ffffff;
        border: 1px solid #9adede;
        border-radius: 6px;
        padding: 8px;
        font-size: 13px;
        box-shadow: 0 0 10px rgba(0, 128, 128, 0.15);
        display: none;
        white-space: pre-line;
        z-index: 100;
        color: #356e6e;
    }

    .curso:hover .tooltip {
        display: block;
    }

    .curso.bloqueado::after {
        content: 'üîí';
        position: absolute;
        right: 10px;
        top: 10px;
    }

    .selector-electivas {
        margin: 20px auto;
        padding: 20px;
        background-color: #e6f7f7;
        border: 1px solid #9adede;
        border-radius: 12px;
        min-width: 250px;
        max-width: 300px;
        flex: 1 1 280px;
    }

    html {
        overflow-x: hidden;
    }
</style>

</head>
<body>
    <div class="panel-superior">
        <div class="progreso">
            <p><strong>Cr√©ditos completados: <span id="creditos">0</span> / <span id="total-creditos">0</span> <span id="info-extra-creditos">(m√≠n: 220)</span></strong></p>

            <div class="barra-contenedor">
                <div class="barra-externa">
                    <div class="barra-interna" id="barra-progreso" style="width: 0%;"></div>
                </div>
                <p><span id="porcentaje">0</span> %</p>
            </div>
            
            <button id="reset">Restablecer progreso</button>
        </div>

        <div class="selector-electivas" id="electivas">
            <strong>Elige tu √°rea electiva:</strong><br>
            <label><input type="checkbox" class="opt" value="talento"> üë• Talento Humano </label><br>
            <label><input type="checkbox" class="opt" value="finanzas"> üè¶ Finanzas </label><br>
            <label><input type="checkbox" class="opt" value="proyectos"> üìÅ Proyectos </label><br>
        </div>
    </div>

    <div class="malla-container" id="contenedor-cursos"></div>

    <script>
        const cursos = [
            // 1er ciclo
            { nombre: "Lenguaje", creditos: 4, ciclo: 1 },
            { nombre: "M√©todos de estudio universitario", creditos: 3, ciclo: 1 },
            { nombre: "Historia del Per√∫", creditos: 3, ciclo: 1 },
            { nombre: "Matem√°tica I", creditos: 4, ciclo: 1 },
            { nombre: "Desarrollo personal", creditos: 3, ciclo: 1 },
            { nombre: "Ingl√©s I", creditos: 2, ciclo: 1 },
            // 2do ciclo
            { nombre: "Investigaci√≥n Acad√©mica", creditos: 3, ciclo: 2 },
            { nombre: "Filosof√≠a y √âtica", creditos: 3, ciclo: 2 },
            { nombre: "Realidad Nacional y Mundial", creditos: 3, ciclo: 2 },
            { nombre: "Matem√°tica II", creditos: 4, ciclo: 2, prereq: ["Matem√°tica I"] },
            { nombre: "Derechos Fundamentales", creditos: 3, ciclo: 2 },
            { nombre: "Ingl√©s II", creditos: 2, ciclo: 2, prereq: ["Ingl√©s I"] },
            // 3er ciclo
            { nombre: "Fundamentos de Marketing", creditos: 3, ciclo: 3 },
            { nombre: "Microeconom√≠a", creditos: 3, ciclo: 3, prereq: ["Realidad Nacional y Mundial"] },
            { nombre: "Estad√≠stica Descriptiva", creditos: 4, ciclo: 3, prereq: ["Matem√°tica II"] },
            { nombre: "Visi√≥n para el Desarrollo Sostenible", creditos: 3, ciclo: 3, prereq: ["Derechos Fundamentales, Ciudadan√≠a y Derechos Humanos"] },
            { nombre: "Antropolog√≠a y Sociolog√≠a Aplicadas al Marketing", creditos: 4, ciclo: 3, prereq: ["Realidad Nacional y Mundial"] },
            { nombre: "Fundamentos de Contabilidad", creditos: 3, ciclo: 3 },
            { nombre: "Fundamentos de Administraci√≥n", creditos: 3, ciclo: 3 },
            // 4to ciclo
            { nombre: "Inteligencia Artificial y Tecnolog√≠as Aplicadas a los Negocios", creditos: 3, ciclo: 4, prereq: ["Fundamentos de Administraci√≥n"] },
            { nombre: "Costos y Presupuestos Aplicados al Marketing", creditos: 4, ciclo: 4, prereq: ["Fundamentos de Contabilidad"] },
            { nombre: "Macroeconom√≠a", creditos: 3, ciclo: 4, prereq: ["Microeconom√≠a"] },
            { nombre: "Estad√≠stica Inferencial", creditos: 4, ciclo: 4, prereq: ["Estad√≠stica Descriptiva"] },
            { nombre: "Investigaci√≥n de Mercados", creditos: 3, ciclo: 4, prereq: ["Investigaci√≥n Acad√©mica"] },
            { nombre: "Psicolog√≠a Cognitiva Aplicada al Marketing", creditos: 3, ciclo: 4, prereq: ["Antropolog√≠a y Sociolog√≠a Aplicadas al Marketing"] },
            { nombre: "Procesos Administrativos", creditos: 3, ciclo: 4, prereq: ["Fundamentos de Administraci√≥n"] },
            // 5to ciclo
            { nombre: "Investigaci√≥n de Mercados Cuantitativa y An√°lisis Big Data", creditos: 4, ciclo: 5, prereq: ["Investigaci√≥n de Mercados"] },
            { nombre: "Entorno Global de los Negocios", creditos: 3, ciclo: 5, prereq: ["Macroeconom√≠a"] },
            { nombre: "Contabilidad Gerencial", creditos: 4, ciclo: 5, prereq: ["Costos y Presupuestos Aplicados al Marketing"] },
            { nombre: "Derecho Comercial y del Consumidor", creditos: 3, ciclo: 5, prereq: ["Derechos Fundamentales, Ciudadan√≠a y Derechos Humanos"] },
            { nombre: "Innovaci√≥n y Marketing Disruptivo", creditos: 3, ciclo: 5, prereq: ["Psicolog√≠a Cognitiva Aplicada al Marketing"] },
            { nombre: "Planeamiento Estrat√©gico", creditos: 3, ciclo: 5, prereq: ["Procesos Administrativos"] },
            { nombre: "Comportamiento del Consumidor", creditos: 3, ciclo: 5, prereq: ["Psicolog√≠a Cognitiva Aplicada al Marketing"] },
            // 6to ciclo
            { nombre: "Investigaci√≥n de Mercados Cualitativa", creditos: 4, ciclo: 6, prereq: ["Investigaci√≥n de Mercados Cuantitativa y An√°lisis Big Data"] },
            { nombre: "Elaboraci√≥n y An√°lisis de los Estados Financieros", creditos: 6, ciclo: 6, prereq: ["Contabilidad Gerencial"] },
            { nombre: "Coaching Empresarial", creditos: 3, ciclo: 6, prereq: ["Innovaci√≥n y Marketing Disruptivo"] },
            { nombre: "Posicionamiento", creditos: 3, ciclo: 6, prereq: ["Comportamiento del Consumidor"] },
            { nombre: "Inteligencia Empresarial (BI)", creditos: 3, ciclo: 6, prereq: ["Planeamiento Estrat√©gico"] },
            { nombre: "Branding e Identidad Corporativa", creditos: 3, ciclo: 6, prereq: ["Comportamiento del Consumidor"] },
            { nombre: "Gesti√≥n de Relaciones y Experiencia del Cliente (CRM)", creditos: 3, ciclo: 6, prereq: ["Innovaci√≥n y Marketing Disruptivo"] },
            // 7mo ciclo
            { nombre: "Product Management", creditos: 3, ciclo: 7, prereq: ["Coaching Empresarial"] },
            { nombre: "Distribuci√≥n Comercial y Log√≠stica", creditos: 3, ciclo: 7, prereq: ["Inteligencia Empresarial (BI)"] },
            { nombre: "Neuromarketing", creditos: 3, ciclo: 7, prereq: ["Posicionamiento"] },
            { nombre: "Marketing Internacional", creditos: 3, ciclo: 7, prereq: ["Inteligencia Empresarial (BI)"] },
            { nombre: "Marketing de Servicios I", creditos: 3, ciclo: 7, prereq: ["Branding e Identidad Corporativa"] },
            { nombre: "Marketing de Redes Sociales (SEO/SEM)", creditos: 3, ciclo: 7, prereq: ["Gesti√≥n de Relaciones y Experiencia del Cliente (CRM)"] },
            { nombre: "Anal√≠tica Web y Data Driven Marketing", creditos: 3, ciclo: 7, prereq: ["Innovaci√≥n y Marketing Disruptivo"], tipo: "Electivo" },
            { nombre: "Herramientas de Inteligencia de Mercados y Software Especializado", creditos: 3, ciclo: 7, prereq: ["Investigaci√≥n de Mercados Cualitativa"], tipo: "Electivo" },
            // 8vo ciclo
            { nombre: "Pol√≠tica y Estrategia de Precios", creditos: 3, ciclo: 8, prereq: ["Product Management"] },
            { nombre: "Ventas y Negociaci√≥n", creditos: 3, ciclo: 8, prereq: ["Distribuci√≥n Comercial y Log√≠stica"] },
            { nombre: "Marketing Sostenible", creditos: 3, ciclo: 8, prereq: ["Inteligencia Empresarial (BI)"] },
            { nombre: "Marketing de Ferias y Eventos", creditos: 3, ciclo: 8, prereq: ["Marketing Internacional"] },
            { nombre: "Marketing de Servicios II", creditos: 4, ciclo: 8, prereq: ["Marketing de Servicios I"] },
            { nombre: "E-Business", creditos: 3, ciclo: 8, prereq: ["Marketing de Redes Sociales (SEO/SEM)"] },
            { nombre: "Personal Branding", creditos: 2, ciclo: 8, prereq: ["Branding e Identidad Corporativa"] },
            { nombre: "Inbound y Outbound Marketing", creditos: 3, ciclo: 8, prereq: ["Anal√≠tica Web y Data Driven Marketing"], tipo: "Electivo" },
            { nombre: "Anal√≠tica de Mercados", creditos: 3, ciclo: 8, prereq: ["Herramientas de Inteligencia de Mercados y Software Especializado"], tipo: "Electivo" },  
            // 9no ciclo
            { nombre: "Legislaci√≥n de la Publicidad y Marketing", creditos: 2, ciclo: 9, prereq: ["Ventas y Negociaci√≥n"] },
            { nombre: "Desarrollo de Investigaci√≥n", creditos: 3, ciclo: 9, prereq: ["Investigaci√≥n de Mercados Cualitativa"] },
            { nombre: "Dise√±o del Plan de Marketing", creditos: 4, ciclo: 9, prereq: ["Pol√≠tica y Estrategia de Precios"] },
            { nombre: "Comunicaci√≥n Integrada de Marketing", creditos: 3, ciclo: 9, prereq: ["Ventas y Negociaci√≥n"] },
            { nombre: "Marketing Analytics and Consumer Insight", creditos: 3, ciclo: 9, prereq: ["Marketing de Servicios II"] },
            { nombre: "Publicidad de Medios", creditos: 3, ciclo: 9, prereq: ["E-Business"] },
            { nombre: "Gesti√≥n Estrat√©gica de Marcas Globales", creditos: 3, ciclo: 9, prereq: ["Marketing de Ferias y Eventos"] },
            { nombre: "Acreditaci√≥n Otro Idioma Extranjero o Lengua Nativa", creditos: 2, ciclo: 9 },
            { nombre: "Content Marketing", creditos: 3, ciclo: 9, prereq: ["Inbound y Outbound Marketing"], tipo: "Electivo" },
            { nombre: "Estrategias Basadas en Anal√≠tica de Mercados", creditos: 3, ciclo: 9, prereq: ["Anal√≠tica de Mercados"], tipo: "Electivo" }, 
            // 10mo ciclo
            { nombre: "Trabajo de Investigaci√≥n", creditos: 6, ciclo: 10, prereq: ["Desarrollo de Investigaci√≥n"] },
            { nombre: "Direcci√≥n de Marketing", creditos: 3, ciclo: 10, prereq: ["Dise√±o del Plan de Marketing"] },
            { nombre: "Direcci√≥n de Ventas", creditos: 3, ciclo: 10, prereq: ["Comunicaci√≥n Integrada de Marketing"] },
            { nombre: "√âtica y Responsabilidad Social", creditos: 3, ciclo: 10, prereq: ["Marketing Sostenible"] },
            { nombre: "Plan de Negocios", creditos: 4, ciclo: 10, prereq: ["Dise√±o del Plan de Marketing"] },
            { nombre: "Prospectiva de Mercados", creditos: 3, ciclo: 10, prereq: ["Gesti√≥n Estrat√©gica de Marcas Globales"] },
            { nombre: "Acreditaci√≥n Idioma", creditos: 3, ciclo: 10 },
        ];
        
        const iconosAreas = {
            talento: "üë•",
            finanzas: "üè¶",
            proyectos: "üìÅ",
        };

        // Variables para controlar las alertas una sola vez
        let alertaProyectosMostrada = false;
        let alertaFinanzasMostrada = false;

        const carrera = 'maritima'; // Cambia por 'negocios', 'marketing', etc. en cada archivo
        const prefix = carrera + '_';
        
        function guardarElectivas() {
            const seleccionadas = Array.from(document.querySelectorAll('.opt:checked')).map(e => e.value);
            localStorage.setItem(prefix + 'electivasSeleccionadas', JSON.stringify(seleccionadas));
        }

        function cargarElectivas() {
            const guardadas = JSON.parse(localStorage.getItem(prefix + 'electivasSeleccionadas') || '[]');
            document.querySelectorAll('.opt').forEach(opt => {
                opt.checked = guardadas.includes(opt.value);
            });
        }

        function calcularCreditosTotales() {
            const electivas = JSON.parse(localStorage.getItem(prefix + 'electivasSeleccionadas') || '[]');
            return cursos.reduce((suma, curso) => {
                if (curso.area && !electivas.includes(curso.area)) return suma;
                return suma + curso.creditos;
            }, 0);
        }

        function actualizarCreditos() {
            const electivas = JSON.parse(localStorage.getItem(prefix + 'electivasSeleccionadas') || '[]');
            let suma = 0;
            let total = 0;

            cursos.forEach(curso => {
                // Solo contar cursos que est√°n en las √°reas seleccionadas o que no tienen √°rea
                if (curso.area && !electivas.includes(curso.area)) return;
                
                total += curso.creditos;
                
                const estado = localStorage.getItem(prefix + curso.nombre);
                if (estado === "true") {
                    suma += curso.creditos;
                }
            });
            
            const minimo = 220;
            const creditos = document.getElementById("creditos");
            const totalCreditos = document.getElementById("total-creditos");
            const extra = document.getElementById("info-extra-creditos");
            const barra = document.getElementById("barra-progreso");
            const porcentaje = document.getElementById("porcentaje");
            
            if (creditos) creditos.textContent = suma;
            if (totalCreditos) totalCreditos.textContent = total;
            if (extra) extra.textContent = `(m√≠n: ${minimo})`;
            
            const porcentajeValor = total > 0 ? Math.round((suma / total) * 100) : 0;
            if (barra) barra.style.width = `${porcentajeValor}%`;
            if (porcentaje) porcentaje.textContent = porcentajeValor;
        }

        function renderCursos() {
            const contenedor = document.getElementById("contenedor-cursos");
            if (!contenedor) return;
            
            contenedor.innerHTML = ''; // Limpiar contenedor
            
            const electivas = JSON.parse(localStorage.getItem(prefix + 'electivasSeleccionadas') || '[]');
            
            const agrupados = cursos.reduce((acc, curso) => {
                // Solo incluir cursos que est√°n en las √°reas seleccionadas o que no tienen √°rea
                if (curso.area && !electivas.includes(curso.area)) return acc;
                
                if (!acc[curso.ciclo]) acc[curso.ciclo] = [];
                acc[curso.ciclo].push(curso);
                return acc;
            }, {});

            Object.keys(agrupados).sort((a, b) => a - b).forEach(ciclo => {
                const divCiclo = document.createElement("div");
                divCiclo.className = "ciclo";
                const titulo = document.createElement("h2");
                titulo.textContent = `${ciclo}¬∞ Ciclo`;
                divCiclo.appendChild(titulo);

                agrupados[ciclo].forEach(curso => {
                    const estado = localStorage.getItem(prefix + curso.nombre) === "true";
                    const prereqCumplidos = !curso.prereq || curso.prereq.every(p => localStorage.getItem(prefix + p) === "true");

                    const div = document.createElement("div");
                    div.className = "curso";
                    if (estado) div.classList.add("tildado");
                    else if (prereqCumplidos) div.classList.add("activo");
                    else div.classList.add("bloqueado");
                    if (curso.area) div.classList.add("electiva");

                    const icono = curso.area ? `${iconosAreas[curso.area]} ` : "";
                    div.textContent = icono + curso.nombre;

                    const tooltip = document.createElement("div");
                    tooltip.className = "tooltip";
                    tooltip.textContent = `Cr√©ditos: ${curso.creditos}\nPrerrequisitos: ${curso.prereq ? curso.prereq.join(', ') : 'NR'}`;
                    div.appendChild(tooltip);

                    if (div.classList.contains("activo") || div.classList.contains("tildado")) {
                        div.addEventListener("click", () => {
                            const nuevo = !(localStorage.getItem(prefix + curso.nombre) === "true");
                            localStorage.setItem(prefix + curso.nombre, nuevo);
                            renderCursos();
                            actualizarCreditos();
                        });
                    }

                    divCiclo.appendChild(div);
                });

                contenedor.appendChild(divCiclo);
            });
        }

        function mostrarAlerta(area, seleccionadas) {
            if (area === 'proyectos' && !alertaProyectosMostrada) {
                if (seleccionadas.includes('finanzas')) {
                    alert('‚ö†Ô∏è Ten en cuenta que al elegir Finanzas y Proyectos no se alcanza el creditaje m√≠nimo para egresar');
                } else {
                    alert('‚ö†Ô∏è Considera que al elegir Proyectos no se alcanza el creditaje m√≠nimo para egresar');
                }
                alertaProyectosMostrada = true;
            } else if (area === 'finanzas' && !alertaFinanzasMostrada) {
                if (seleccionadas.includes('proyectos')) {
                    alert('‚ö†Ô∏è Ten en cuenta que al elegir Finanzas y Proyectos no se alcanza el creditaje m√≠nimo para egresar');
                } else {
                    alert('‚ö†Ô∏è Considera que al elegir Finanzas no se alcanza el creditaje m√≠nimo para egresar');
                }
                alertaFinanzasMostrada = true;
            }
        }

        // Event listeners para checkboxes de electivas
        function inicializarEventListeners() {
            document.querySelectorAll('.opt').forEach(opt => {
                opt.addEventListener('change', (e) => {
                    const seleccionadasActuales = Array.from(document.querySelectorAll('.opt:checked'));
                    
                    // Verificar l√≠mite de 2 √°reas
                    if (seleccionadasActuales.length > 1) {
                        e.target.checked = false;
                        alert('‚ö†Ô∏è Solo puedes elegir 1 √°rea electiva.');
                        return;
                    }

                    // Si se est√° seleccionando (no deseleccionando)
                    if (e.target.checked) {
                        const valores = seleccionadasActuales.map(checkbox => checkbox.value);
                        mostrarAlerta(e.target.value, valores);
                    }

                    guardarElectivas();
                    renderCursos();
                    actualizarCreditos();
                });
            });

            // Bot√≥n reset
            const resetBtn = document.getElementById("reset");
            if (resetBtn) {
                resetBtn.addEventListener("click", () => {
                    // Eliminar el progreso de todos los cursos
                   for (let i = localStorage.length - 1; i >= 0; i--) {
                            const key = localStorage.key(i);
                            if (key && key.startsWith(prefix)) {
                                localStorage.removeItem(key);
                        }
                    }
                                    
                    // Reiniciar control de alertas
                    alertaProyectosMostrada = false;
                    alertaFinanzasMostrada = false;
                
                    // Destildar checkboxes de electivas
                    document.querySelectorAll('.opt').forEach(opt => opt.checked = false);
                
                    // Volver a cargar todo
                    renderCursos();
                    actualizarCreditos();
                });
            }
        }

        // Inicializar la aplicaci√≥n
        function inicializar() {
            cargarElectivas();
            renderCursos();
            actualizarCreditos();
            inicializarEventListeners();
        }

        // Esperar a que el DOM est√© completamente cargado
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', inicializar);
        } else {
            inicializar();
        }
    </script>
</body>
</html>
