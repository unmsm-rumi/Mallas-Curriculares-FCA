<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .panel-superior {
            max-width: 1200px;
            margin: 20px auto;
            display: flex;
            gap: 40px;
            justify-content: center;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .progreso {
            background-color: #ffe6e6;
            border: 1px solid #ff9999;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            min-width: 250px;
            max-width: 520px;
            flex: 1 1 300px;
        }
        
        .barra-contenedor {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .barra-externa {
            flex: 1;
            width: 100%;
            background-color: #ffcccc;
            border-radius: 10px;
            overflow: hidden;
            height: 16px;
            margin: 8px 0;
        }
        
        .barra-interna {
            height: 100%;
            background-color: #cc0000;
            width: 0%;
            transition: width 0.4s ease;
        }
        
        .porcentaje {
            font-weight: bold;
            color: #b30000;
        }
        
        .progreso button {
            padding: 10px 20px;
            background-color: #e60000;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }
        
        .progreso button:hover {
            background-color: #cc0000;
        }
        
        .malla-container {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 20px;
            padding-bottom: 20px;
            max-width: 150vw;
            box-sizing: border-box;
        }
        
        .ciclo {
            width: 280px;
            max-width: 320px;
            min-width: 320px;
            flex-shrink: 0;
            background-color: #ffe6e6;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #ffb3b3;
        }
        
        .ciclo h2 {
            color: #b30000;
            text-align: center;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .curso {
            width: 100%;
            box-sizing: border-box;
            position: relative;
            padding: 10px;
            background-color: #fff0f0;
            border-radius: 10px;
            border: 1px solid #ff9999;
            cursor: default;
            transition: all 0.3s ease;
            text-align: center;
            margin-bottom: 10px;
            opacity: 0.6;
        }
        
        .curso.activo {
            background-color: #ffd6d6;
            border-color: #b30000;
            color: #b30000;
            font-weight: bold;
            cursor: pointer;
            opacity: 1;
        }
        
        .curso.tildado {
            text-decoration: line-through;
            background-color: #f5d1d1;
            color: #777;
            opacity: 1;
            cursor: pointer;
        }
        
        .curso.electiva {
            border: 2px dashed #ff6666;
            background-color: #ffe6e6;
        }
        
        .tooltip {
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff;
            border: 1px solid #ffb3b3;
            border-radius: 6px;
            padding: 8px;
            font-size: 13px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: none;
            white-space: pre-line;
            z-index: 100;
        }
        
        .curso:hover .tooltip {
            display: block;
        }
        
        .curso.bloqueado::after {
            content: 'üîí';
            position: absolute;
            right: 10px;
            top: 10px;
        }
        
        .selector-electivas {
            margin: 20px auto;
            padding: 20px;
            background-color: #fff0f0;
            border: 1px solid #ff9999;
            border-radius: 12px;
            min-width: 250px;
            max-width: 300px;
            flex: 1 1 280px;
        }

        html {
            overflow-x: hidden;
        }  
    </style>
</head>
<body>
    <div class="panel-superior">
        <div class="progreso">
            <p><strong>Cr√©ditos completados: <span id="creditos">0</span> / <span id="total-creditos">0</span> <span id="info-extra-creditos">(m√≠n: 220)</span></strong></p>

            <div class="barra-contenedor">
                <div class="barra-externa">
                    <div class="barra-interna" id="barra-progreso" style="width: 0%;"></div>
                </div>
                <p><span id="porcentaje">0</span> %</p>
            </div>
            
            <button id="reset">Restablecer progreso</button>
        </div>

        <div class="selector-electivas" id="electivas">
            <strong>Elige tus 2 √°reas electivas:</strong><br>
            <label><input type="checkbox" class="opt" value="finanzas"> üè¶ Finanzas Internacionales</label><br>
            <label><input type="checkbox" class="opt" value="marketing"> üí° Marketing Internacional</label><br>
            <label><input type="checkbox" class="opt" value="logistica"> üö¢ Log√≠stica Global</label>
  </div>

        </div>
    </div>

    <div class="malla-container" id="contenedor-cursos"></div>

    <script>
        const cursos = [
            // 1er ciclo
            { nombre: "Lenguaje", creditos: 4, ciclo: 1 },
            { nombre: "M√©todos de estudio universitario", creditos: 3, ciclo: 1 },
            { nombre: "Historia del Per√∫", creditos: 3, ciclo: 1 },
            { nombre: "Matem√°tica I", creditos: 4, ciclo: 1 },
            { nombre: "Desarrollo personal", creditos: 3, ciclo: 1 },
            { nombre: "Ingl√©s I", creditos: 2, ciclo: 1 },
          
            // 2do ciclo
            { nombre: "Investigaci√≥n Acad√©mica", creditos: 3, ciclo: 2 },
            { nombre: "Filosof√≠a y √âtica", creditos: 3, ciclo: 2 },
            { nombre: "Realidad Nacional y mundial", creditos: 3, ciclo: 2 },
            { nombre: "Matem√°tica II", creditos: 4, ciclo: 2, prereq: ["Matem√°tica I"] },
            { nombre: "Derechos Fundamentales", creditos: 3, ciclo: 2 },
            { nombre: "Ingl√©s II", creditos: 2, ciclo: 2, prereq: ["Ingl√©s I"] },
          
            // 3er ciclo
            { nombre: "Estad√≠stica Descriptiva", creditos: 4, ciclo: 3 },
            { nombre: "Microeconom√≠a", creditos: 3, ciclo: 3 },
            { nombre: "Visi√≥n para el desarrollo", creditos: 3, ciclo: 3 },
            { nombre: "Fundamentos de la administraci√≥n", creditos: 4, ciclo: 3 },
            { nombre: "TICs para la gesti√≥n", creditos: 3, ciclo: 3 },
            { nombre: "Fundamentos de la contabilidad", creditos: 3, ciclo: 3 },
            { nombre: "Desarrollo sostenible", creditos: 2, ciclo: 3 },
          
            // 4to ciclo
            { nombre: "Estad√≠stica Inferencial", creditos: 4, ciclo: 4, prereq: ["Estad√≠stica Descriptiva"] },
            { nombre: "Macroeconom√≠a", creditos: 3, ciclo: 4, prereq: ["Microeconom√≠a"] },
            { nombre: "Derecho empresarial", creditos: 3, ciclo: 4 },
            { nombre: "Investigaci√≥n cient√≠fica", creditos: 3, ciclo: 4, prereq: ["Visi√≥n para el desarrollo"] },
            { nombre: "Procesos administrativos", creditos: 4, ciclo: 4, prereq: ["Fundamentos de la administraci√≥n"] },
            { nombre: "Costos y presupuestos", creditos: 3, ciclo: 4, prereq: ["Fundamentos de la contabilidad"] },
            { nombre: "Matem√°tica financiera", creditos: 4, ciclo: 4 },
          
            // 5to ciclo
            { nombre: "Planeamiento estrat√©gico", creditos: 3, ciclo: 5, prereq: ["Procesos administrativos"] },
            { nombre: "Contabilidad administrativa", creditos: 3, ciclo: 5, prereq: ["Costos y presupuestos"] },
            { nombre: "Econom√≠a Internacional", creditos: 3, ciclo: 5, prereq: ["Macroeconom√≠a"] },
            { nombre: "Negocios Internacionales", creditos: 3, ciclo: 5, prereq: ["Macroeconom√≠a"] },
            { nombre: "Finanzas Corporativas I", creditos: 3, ciclo: 5, prereq: ["Matem√°tica financiera"] },
            { nombre: "Log√≠stica Internacional", creditos: 3, ciclo: 5 },
            { nombre: "Legislaci√≥n Laboral", creditos: 2, ciclo: 5, prereq: ["Derecho empresarial"] },
            { nombre: "Marketing", creditos: 3, ciclo: 5 },
          
            // 6to ciclo
            { nombre: "Dise√±o organizacional y procesos", creditos: 3, ciclo: 6, prereq: ["Planeamiento estrat√©gico"] },
            { nombre: "Costos, precios y cotizaciones internacionales", creditos: 3, ciclo: 6, prereq: ["Contabilidad administrativa"] },
            { nombre: "Integraci√≥n econ√≥mica", creditos: 3, ciclo: 6, prereq: ["Econom√≠a Internacional"] },
            { nombre: "Comercio internacional", creditos: 3, ciclo: 6, prereq: ["Econom√≠a Internacional"] },
            { nombre: "Finanzas corporativas II", creditos: 3, ciclo: 6, prereq: ["Finanzas Corporativas I"] },
            { nombre: "Investigaci√≥n de mercados internacionales", creditos: 3, ciclo: 6, prereq: ["Estad√≠stica Inferencial"] },
            { nombre: "T√©cnicas de investigaci√≥n cuantitativa", creditos: 3, ciclo: 6, prereq: ["Investigaci√≥n cient√≠fica"] },
            { nombre: "Marketing internacional", creditos: 3, ciclo: 6, prereq: ["Marketing"] },
          
            // 7mo ciclo
            { nombre: "Gesti√≥n del talento humano internacional", creditos: 3, ciclo: 7, prereq: ["Dise√±o organizacional y procesos"] },
            { nombre: "√âtica y responsabilidad social empresarial", creditos: 3, ciclo: 7, prereq: ["Integraci√≥n econ√≥mica"] },
            { nombre: "Tratados y convenios Internacionales", creditos: 3, ciclo: 7, prereq: ["Integraci√≥n econ√≥mica"] },
            { nombre: "Agronegocios y cadenas productivas", creditos: 3, ciclo: 7, prereq: ["Comercio internacional"] },
            { nombre: "T√©cnicas de investigaci√≥n cualitativa", creditos: 3, ciclo: 7, prereq: ["T√©cnicas de investigaci√≥n cuantitativa"] },
            { nombre: "Derecho Internacional", creditos: 2, ciclo: 7, prereq: ["Legislaci√≥n Laboral"] },
            { nombre: "Gesti√≥n de Inversi√≥n Global (Mercado de Capitales)", creditos: 3, ciclo: 7, prereq: ["Finanzas corporativas II"], area: "finanzas" },
            { nombre: "Marketing Digital", creditos: 3, ciclo: 7, prereq: ["Marketing internacional"], area: "marketing" },
            { nombre: "Envases y Embalajes", creditos: 3, ciclo: 7, prereq: ["Log√≠stica Internacional"], area: "logistica" },
          
            // 8vo ciclo
            { nombre: "Estrategias e internacionalizaci√≥n de empresas", creditos: 3, ciclo: 8, prereq: ["Gesti√≥n del talento humano internacional"] },
            { nombre: "Formulaci√≥n de proyectos de inversi√≥n", creditos: 4, ciclo: 8, prereq: ["Costos, precios y cotizaciones internacionales"] },
            { nombre: "Interculturalidad en los negocios", creditos: 3, ciclo: 8, prereq: ["Tratados y convenios Internacionales"] },
            { nombre: "Ferias y misiones comerciales", creditos: 3, ciclo: 8, prereq: ["Agronegocios y cadenas productivas"] },
            { nombre: "M√©todos cuantitativos", creditos: 3, ciclo: 8, prereq: ["Investigaci√≥n de mercados internacionales"] },
            { nombre: "Evaluaci√≥n de riesgos financieros", creditos: 3, ciclo: 8, prereq: ["Gesti√≥n de Inversi√≥n Global (Mercado de Capitales)"], area: "finanzas" },
            { nombre: "Estrategias de Distribuci√≥n Internacional", creditos: 3, ciclo: 8, prereq: ["Marketing Digital"], area: "marketing" },
            { nombre: "Distribuci√≥n F√≠sica Internacional", creditos: 3, ciclo: 8, prereq: ["Envases y Embalajes"], area: "logistica" },
          
            // 9no ciclo
            { nombre: "Direcci√≥n estrat√©gica de empresas internacionales", creditos: 3, ciclo: 9, prereq: ["Estrategias e internacionalizaci√≥n de empresas"] },
            { nombre: "Evaluaci√≥n de proyectos de inversi√≥n", creditos: 4, ciclo: 9, prereq: ["Formulaci√≥n de proyectos de inversi√≥n"] },
            { nombre: "Cooperaci√≥n internacional: Multilateral, p√∫blica y privada", creditos: 3, ciclo: 9, prereq: ["Interculturalidad en los negocios"] },
            { nombre: "Clasificaci√≥n arancelaria y valoraci√≥n aduanera", creditos: 3, ciclo: 9, prereq: ["Tratados y convenios Internacionales"] },
            { nombre: "Desarrollo de investigaci√≥n I", creditos: 3, ciclo: 9, prereq: ["T√©cnicas de investigaci√≥n cualitativa"] },
            { nombre: "Gesti√≥n de riesgos a trav√©s de productos y derivados", creditos: 3, ciclo: 9, prereq: ["Evaluaci√≥n de riesgos financieros"], area: "finanzas" },
            { nombre: "Estrategia de Ingreso en los Mercados Internacionales", creditos: 3, ciclo: 9, prereq: ["Estrategias de Distribuci√≥n Internacional"], area: "marketing" },
            { nombre: "Transporte de Carga Internacional y seguro", creditos: 3, ciclo: 9, prereq: ["Distribuci√≥n F√≠sica Internacional"], area: "logistica" },
          
            // 10mo ciclo
            { nombre: "Prospectiva estrat√©gica empresarial", creditos: 3, ciclo: 10, prereq: ["Direcci√≥n estrat√©gica de empresas internacionales"] },
            { nombre: "Gerencia de Proyectos", creditos: 4, ciclo: 10, prereq: ["Evaluaci√≥n de proyectos de inversi√≥n"] },
            { nombre: "Pol√≠ticas y negociaciones internacionales", creditos: 3, ciclo: 10, prereq: ["Cooperaci√≥n internacional: Multilateral, p√∫blica y privada"] },
            { nombre: "Gesti√≥n aduanera", creditos: 4, ciclo: 10, prereq: ["Clasificaci√≥n arancelaria y valoraci√≥n aduanera"] },
            { nombre: "Desarrollo de Investigaci√≥n II", creditos: 3, ciclo: 10, prereq: ["Desarrollo de investigaci√≥n I"] },
            { nombre: "International Financial Management (Direcci√≥n Financiera Internacional)", creditos: 3, ciclo: 10, prereq: ["Gesti√≥n de riesgos a trav√©s de productos y derivados"], area: "finanzas" },
            { nombre: "International Marketing Management", creditos: 3, ciclo: 10, prereq: ["Estrategia de Ingreso en los Mercados Internacionales"], area: "marketing" },
            { nombre: "Global Logistics Management (Direcci√≥n Log√≠stica Global)", creditos: 3, ciclo: 10, prereq: ["Transporte de Carga Internacional y seguro"], area: "logistica" },
        ];

        const iconosAreas = {
            finanzas: "üè¶",
            marketing: "üí°",
            log√≠stica: "üö¢"
        };

        function guardarElectivas() {
            const seleccionadas = Array.from(document.querySelectorAll('.opt:checked')).map(e => e.value);
            localStorage.setItem('electivasSeleccionadas', JSON.stringify(seleccionadas));
        }

        function cargarElectivas() {
            const guardadas = JSON.parse(localStorage.getItem('electivasSeleccionadas') || '[]');
            document.querySelectorAll('.opt').forEach(opt => {
                opt.checked = guardadas.includes(opt.value);
            });
        }

        function calcularCreditosTotales() {
            const electivas = JSON.parse(localStorage.getItem('electivasSeleccionadas') || '[]');
            return cursos.reduce((suma, curso) => {
                if (curso.area && !electivas.includes(curso.area)) return suma;
                return suma + curso.creditos;
            }, 0);
        }

        function actualizarCreditos() {
            const electivas = JSON.parse(localStorage.getItem('electivasSeleccionadas') || '[]');
            let suma = 0;
            let total = 0;

            cursos.forEach(curso => {
                // Solo contar cursos que est√°n en las √°reas seleccionadas o que no tienen √°rea
                if (curso.area && !electivas.includes(curso.area)) return;
                
                total += curso.creditos;
                
                const estado = localStorage.getItem(curso.nombre);
                if (estado === "true") {
                    suma += curso.creditos;
                }
            });
            
            const minimo = 220;
            const creditos = document.getElementById("creditos");
            const totalCreditos = document.getElementById("total-creditos");
            const extra = document.getElementById("info-extra-creditos");
            const barra = document.getElementById("barra-progreso");
            const porcentaje = document.getElementById("porcentaje");
            
            if (creditos) creditos.textContent = suma;
            if (totalCreditos) totalCreditos.textContent = total;
            if (extra) extra.textContent = `(m√≠n: ${minimo})`;
            
            const porcentajeValor = total > 0 ? Math.round((suma / total) * 100) : 0;
            if (barra) barra.style.width = `${porcentajeValor}%`;
            if (porcentaje) porcentaje.textContent = porcentajeValor;
        }

        function renderCursos() {
            const contenedor = document.getElementById("contenedor-cursos");
            contenedor.innerHTML = ''; // Limpiar contenedor
            
            const electivas = Array.from(document.querySelectorAll('.opt:checked')).map(e => e.value);
            
            const agrupados = cursos.reduce((acc, curso) => {
                // Solo incluir cursos que est√°n en las √°reas seleccionadas o que no tienen √°rea
                if (curso.area && !electivas.includes(curso.area)) return acc;
                
                if (!acc[curso.ciclo]) acc[curso.ciclo] = [];
                acc[curso.ciclo].push(curso);
                return acc;
            }, {});

            Object.keys(agrupados).sort((a, b) => a - b).forEach(ciclo => {
                const divCiclo = document.createElement("div");
                divCiclo.className = "ciclo";
                const titulo = document.createElement("h2");
                titulo.textContent = `${ciclo}¬∞ Ciclo`;
                divCiclo.appendChild(titulo);

                agrupados[ciclo].forEach(curso => {
                    const estado = localStorage.getItem(curso.nombre) === "true";
                    const prereqCumplidos = !curso.prereq || curso.prereq.every(p => localStorage.getItem(p) === "true");

                    const div = document.createElement("div");
                    div.className = "curso";
                    if (estado) div.classList.add("tildado");
                    else if (prereqCumplidos) div.classList.add("activo");
                    else div.classList.add("bloqueado");
                    if (curso.area) div.classList.add("electiva");

                    const icono = curso.area ? `${iconosAreas[curso.area]} ` : "";
                    div.textContent = icono + curso.nombre;

                    const tooltip = document.createElement("div");
                    tooltip.className = "tooltip";
                    tooltip.textContent = `Cr√©ditos: ${curso.creditos}\nPrerrequisitos: ${curso.prereq ? curso.prereq.join(', ') : 'NR'}`;
                    div.appendChild(tooltip);

                    if (div.classList.contains("activo") || div.classList.contains("tildado")) {
                        div.addEventListener("click", () => {
                            const nuevo = !(localStorage.getItem(curso.nombre) === "true");
                            localStorage.setItem(curso.nombre, nuevo);
                            renderCursos();
                            actualizarCreditos();
                        });
                    }

                    divCiclo.appendChild(div);
                });

                contenedor.appendChild(divCiclo);
            });
        }

        // Event listeners para checkboxes de electivas
        document.querySelectorAll('.opt').forEach(opt => {
            opt.addEventListener('change', () => {
                const seleccionadas = Array.from(document.querySelectorAll('.opt:checked'));
                if (seleccionadas.length > 2) {
                    opt.checked = false;
                    alert('‚ö†Ô∏è Solo puedes elegir 2 √°reas electivas.');
                    return;
                }
                guardarElectivas();
                renderCursos();
                actualizarCreditos();
            });
        });

        // Bot√≥n reset
        document.getElementById("reset").addEventListener("click", () => {
            // Eliminar el progreso de todos los cursos
            cursos.forEach(curso => {
                localStorage.removeItem(curso.nombre);
            });
        
            // Eliminar √°reas electivas seleccionadas
            localStorage.removeItem('electivasSeleccionadas');
        
            // Destildar checkboxes de electivas
            document.querySelectorAll('.opt').forEach(opt => opt.checked = false);
        
            // Volver a cargar todo
            renderCursos();
            actualizarCreditos();
        });

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            cargarElectivas();
            renderCursos();
            actualizarCreditos();
        });
        
        // Tambi√©n ejecutar inmediatamente por si el DOM ya est√° cargado
        cargarElectivas();
        renderCursos();
        actualizarCreditos();
    </script>
</body>
</html>
