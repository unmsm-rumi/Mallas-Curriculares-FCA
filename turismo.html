<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .panel-superior {
            max-width: 1200px;
            margin: 20px auto;
            display: flex;
            gap: 40px;
            justify-content: center;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .progreso {
            background-color: #e6ffea;
            border: 1px solid #99e6a3;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            min-width: 250px;
            max-width: 520px;
            flex: 1 1 300px;
        }
        
        .barra-contenedor {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .barra-externa {
            flex: 1;
            width: 100%;
            background-color: #ccf5d5;
            border-radius: 10px;
            overflow: hidden;
            height: 16px;
            margin: 8px 0;
        }
        
        .barra-interna {
            height: 100%;
            background-color: #33cc66;
            width: 0%;
            transition: width 0.4s ease;
        }
        
        .porcentaje {
            font-weight: bold;
            color: #009933;
        }
        
        .progreso button {
            padding: 10px 20px;
            background-color: #00b33c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }
        
        .progreso button:hover {
            background-color: #009933;
        }
        
        .malla-container {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 20px;
            padding-bottom: 20px;
            max-width: 150vw;
            box-sizing: border-box;
        }
        
        .ciclo {
            width: 280px;
            max-width: 320px;
            min-width: 320px;
            flex-shrink: 0;
            background-color: #e6ffea;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #b3ffcc;
        }
        
        .ciclo h2 {
            color: #00802b;
            text-align: center;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .curso {
            width: 100%;
            box-sizing: border-box;
            position: relative;
            padding: 10px;
            background-color: #f0fff5;
            border-radius: 10px;
            border: 1px solid #99e6a3;
            cursor: default;
            transition: all 0.3s ease;
            text-align: center;
            margin-bottom: 10px;
            opacity: 0.6;
        }
        
        .curso.activo {
            background-color: #ccffdd;
            border-color: #00802b;
            color: #00802b;
            font-weight: bold;
            cursor: pointer;
            opacity: 1;
        }
        
        .curso.tildado {
            text-decoration: line-through;
            background-color: #d1f5e0;
            color: #777;
            opacity: 1;
            cursor: pointer;
        }
        
        .curso.electiva {
            border: 2px dashed #66cc99;
            background-color: #e6ffea;
        }
        
        .tooltip {
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff;
            border: 1px solid #b3ffcc;
            border-radius: 6px;
            padding: 8px;
            font-size: 13px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: none;
            white-space: pre-line;
            z-index: 100;
        }
        
        .curso:hover .tooltip {
            display: block;
        }
        
        .curso.bloqueado::after {
            content: 'üîí';
            position: absolute;
            right: 10px;
            top: 10px;
        }
        
        .selector-electivas {
            margin: 20px auto;
            padding: 20px;
            background-color: #f0fff5;
            border: 1px solid #99e6a3;
            border-radius: 12px;
            min-width: 250px;
            max-width: 300px;
            flex: 1 1 280px;
        }
        

        html {
            overflow-x: hidden;
        }  
    </style>
</head>
<body>
    <div class="panel-superior">
        <div class="progreso">
            <p><strong>Cr√©ditos completados: <span id="creditos">0</span> / <span id="total-creditos">0</span> <span id="info-extra-creditos">(m√≠n: 220)</span></strong></p>

            <div class="barra-contenedor">
                <div class="barra-externa">
                    <div class="barra-interna" id="barra-progreso" style="width: 0%;"></div>
                </div>
                <p><span id="porcentaje">0</span> %</p>
            </div>
            
            <button id="reset">Restablecer progreso</button>
        </div>

        <div class="selector-electivas" id="electivas">
            <strong>Elige tus 2 √°reas electivas:</strong><br>
            <label><input type="checkbox" class="opt" value="turisticos"> üß≥ Servicios tur√≠sticos</label><br>
            <label><input type="checkbox" class="opt" value="hospedaje"> üè® Servicios de hospedaje</label><br>
            <label><input type="checkbox" class="opt" value="gastronomicos"> üçõ Servicios gastron√≥micos</label>
  </div>

        </div>
    </div>

    <div class="malla-container" id="contenedor-cursos"></div>

    <script>
        const cursos = [
            // 1er ciclo
            { nombre: "Lenguaje", creditos: 4, ciclo: 1 },
            { nombre: "M√©todos de estudio universitario", creditos: 3, ciclo: 1 },
            { nombre: "Historia del Per√∫", creditos: 3, ciclo: 1 },
            { nombre: "Matem√°tica I", creditos: 4, ciclo: 1 },
            { nombre: "Desarrollo personal", creditos: 3, ciclo: 1 },
            { nombre: "Ingl√©s I", creditos: 2, ciclo: 1 },
          
            // 2do ciclo
            { nombre: "Investigaci√≥n Acad√©mica", creditos: 3, ciclo: 2 },
            { nombre: "Filosof√≠a y √âtica", creditos: 3, ciclo: 2 },
            { nombre: "Realidad Nacional y mundial", creditos: 3, ciclo: 2 },
            { nombre: "Matem√°tica II", creditos: 4, ciclo: 2, prereq: ["Matem√°tica I"] },
            { nombre: "Derechos Fundamentales", creditos: 3, ciclo: 2 },
            { nombre: "Ingl√©s II", creditos: 2, ciclo: 2, prereq: ["Ingl√©s I"] },
          
            // 3er ciclo
            { nombre: "Estad√≠stica Descriptiva", creditos: 4, ciclo: 3 },
            { nombre: "Microeconom√≠a", creditos: 3, ciclo: 3 },
            { nombre: "Visi√≥n para el desarrollo", creditos: 3, ciclo: 3, prereq: ["Investigaci√≥n Acad√©mica"]  },
            { nombre: "Fundamentos de la administraci√≥n", creditos: 4, ciclo: 3 },
            { nombre: "TICs para la gesti√≥n", creditos: 3, ciclo: 3 },
            { nombre: "Fundamentos de la contabilidad", creditos: 3, ciclo: 3 },
            { nombre: "Desarrollo sostenible", creditos: 2, ciclo: 3 },
            { nombre: "Fundamentos del Turismo", creditos: 4, ciclo: 3 },
          
            // 4to ciclo
            { nombre: "Estad√≠stica Inferencial", creditos: 4, ciclo: 4, prereq: ["Estad√≠stica Descriptiva"] },
            { nombre: "Macroeconom√≠a", creditos: 3, ciclo: 4, prereq: ["Microeconom√≠a"] },
            { nombre: "Derecho empresarial", creditos: 3, ciclo: 4 },
            { nombre: "Investigaci√≥n cient√≠fica", creditos: 3, ciclo: 4, prereq: ["Visi√≥n para el desarrollo"] },
            { nombre: "Procesos administrativos", creditos: 4, ciclo: 4, prereq: ["Fundamentos de la administraci√≥n"] },
            { nombre: "Costos y presupuestos", creditos: 3, ciclo: 4, prereq: ["Fundamentos de la contabilidad"] },
            { nombre: "Matem√°tica financiera", creditos: 4, ciclo: 4 },
          
            // 5to ciclo
            { nombre: "M√©todos Cuantitativos", creditos: 3, ciclo: 5, prereq: ["Estad√≠stica Inferencial"] },
            { nombre: "Econom√≠a Tur√≠stica", creditos: 3, ciclo: 5, prereq: ["Macroeconom√≠a"] },
            { nombre: "Legislaci√≥n Tur√≠stica", creditos: 2, ciclo: 5, prereq: ["Derecho empresarial"] },
            { nombre: "Turismo sostenible", creditos: 3, ciclo: 5 },
            { nombre: "Planificaci√≥n Estrat√©gica para el Desarrollo Tur√≠stico", creditos: 4, ciclo: 5 },
            { nombre: "Patrimonio Cultural", creditos: 3, ciclo: 5 },
            { nombre: "Geograf√≠a Tur√≠stica", creditos: 3, ciclo: 5 },
          
            // 6to ciclo
            { nombre: "Investigaci√≥n de Mercados Tur√≠sticos", creditos: 3, ciclo: 6, prereq: ["M√©todos Cuantitativos"] },
            { nombre: "T√©cnicas de Investigaci√≥n Cualitativa", creditos: 3, ciclo: 6, prereq: ["Investigaci√≥n Acad√©mica"] },
            { nombre: "Tourism service business administration (Administraci√≥n de Empresas de servicios)", creditos: 3, ciclo: 6, prereq: ["Fundamentos del Turismo"] },
            { nombre: "Responsabilidad Social", creditos: 3, ciclo: 6 },
            { nombre: "Patrimonio Natural", creditos: 3, ciclo: 6, prereq: ["Patrimonio Cultural"] },
            { nombre: "Turismo alternativo", creditos: 3, ciclo: 6 },
            { nombre: "Elaboraci√≥n de paquetes y circuitos tur√≠sticos", creditos: 3, ciclo: 6, area: "turisticos" },
            { nombre: "Operaciones en establecimientos de hospedaje", creditos: 3, ciclo: 6, area: "hospedaje" },
            { nombre: "Tecnolog√≠a de comedor y manipulaci√≥n de alimentos", creditos: 3, ciclo: 6, area: "gastronomicos" },
          
            // 7mo ciclo
            { nombre: "Tourism Services Marketing", creditos: 3, ciclo: 7, prereq: ["Investigaci√≥n de Mercados Tur√≠sticos"] },
            { nombre: "T√©cnicas de Investigaci√≥n Cuantitativa", creditos: 3, ciclo: 7, prereq: ["T√©cnicas de Investigaci√≥n Cualitativa"] },
            { nombre: "Comportamiento Organizacional", creditos: 3, ciclo: 7, prereq: ["Tourism service business administration (Administraci√≥n de Empresas de servicios)"] },
            { nombre: "Log√≠stica en empresas tur√≠sticas", creditos: 3, ciclo: 7 },
            { nombre: "Gesti√≥n de la Calidad Tur√≠stica", creditos: 3, ciclo: 7, prereq: ["Fundamentos del Turismo"] },
            { nombre: "Administraci√≥n de Empresas de transporte tur√≠stico", creditos: 3, ciclo: 7, prereq: ["Elaboraci√≥n de paquetes y circuitos tur√≠sticos"], area: "turisticos" },
            { nombre: "Gesti√≥n de Reservas y Recepci√≥n", creditos: 3, ciclo: 7, prereq: ["Operaciones en establecimientos de hospedaje"], area: "hospedaje" },
            { nombre: "Gastronom√≠a Peruana", creditos: 3, ciclo: 7, prereq: ["Tecnolog√≠a de comedor y manipulaci√≥n de alimentos"], area: "gastronomicos" },
          
            // 8vo ciclo
            { nombre: "Marketing Digital aplicado al Turismo", creditos: 3, ciclo: 8, prereq: ["Tourism Services Marketing"] },
            { nombre: "Proyecto de Investigaci√≥n", creditos: 3, ciclo: 8, prereq: ["T√©cnicas de Investigaci√≥n Cuantitativa"] },
            { nombre: "Gesti√≥n del Talento Humano en empresas tur√≠sticas", creditos: 3, ciclo: 8, prereq: ["Comportamiento Organizacional"] },
            { nombre: "Organization of congresses and tourist events (Organizaci√≥n de congresos y eventos tur√≠sticos)", creditos: 3, ciclo: 8, prereq: ["Log√≠stica en empresas tur√≠sticas"] },
            { nombre: "Gesti√≥n p√∫blica en turismo", creditos: 3, ciclo: 8, prereq: ["Planificaci√≥n Estrat√©gica para el Desarrollo Tur√≠stico"] },
            { nombre: "Gu√≠a de Turismo", creditos: 3, ciclo: 8, prereq: ["Administraci√≥n de Empresas de transporte tur√≠stico"], area: "turisticos" },
            { nombre: "Housekeeping", creditos: 3, ciclo: 8, prereq: ["Gesti√≥n de Reservas y Recepci√≥n"], area: "hospedaje" },
            { nombre: "Gastronom√≠a Internacional", creditos: 3, ciclo: 8, prereq: ["Gastronom√≠a Peruana"], area: "gastronomicos" },
          
            // 9no ciclo
            { nombre: "Sales in tourist companies", creditos: 3, ciclo: 9, prereq: ["Investigaci√≥n de Mercados Tur√≠sticos"] },
            { nombre: "Desarrollo de Investigaci√≥n I", creditos: 4, ciclo: 9, prereq: ["Proyecto de Investigaci√≥n"] },
            { nombre: "Auditor√≠a de empresas tur√≠sticas", creditos: 4, ciclo: 9, prereq: ["Tourism service business administration (Administraci√≥n de Empresas de servicios)"] },
            { nombre: "Creatividad e Innovaci√≥n en empresas Tur√≠sticas", creditos: 3, ciclo: 9 },
            { nombre: "Formulaci√≥n y Evaluaci√≥n de Proyectos de Inversi√≥n Tur√≠stica", creditos: 4, ciclo: 9 },
            { nombre: "Sistema de reservas - GDS", creditos: 3, ciclo: 9, prereq: ["Gu√≠a de Turismo"], area: "turisticos" },
            { nombre: "Sistemas operativos hoteleros", creditos: 3, ciclo: 9, prereq: ["Housekeeping"], area: "hospedaje" },
            { nombre: "Bar y Cocteler√≠a", creditos: 3, ciclo: 9, prereq: ["Gastronom√≠a Internacional"], area: "gastronomicos" },
          
            // 10mo ciclo
            { nombre: "Gesti√≥n de destinos tur√≠sticos", creditos: 3, ciclo: 10, prereq: ["Sales in tourist companies"] },
            { nombre: "Desarrollo de Investigaci√≥n II", creditos: 4, ciclo: 10, prereq: ["Desarrollo de Investigaci√≥n I"] },
            { nombre: "Strategic management of tourist companies (Direcci√≥n estrat√©gica de empresas tur√≠sticas)", creditos: 3, ciclo: 10, prereq: ["Auditor√≠a de empresas tur√≠sticas"] },
            { nombre: "Gesti√≥n de Alimentos y Bebidas", creditos: 3, ciclo: 10, prereq: ["Organization of congresses and tourist events (Organizaci√≥n de congresos y eventos tur√≠sticos)"] },
            { nombre: "Gesti√≥n y Direcci√≥n de establecimiento de hospedaje", creditos: 3, ciclo: 10, prereq: ["Formulaci√≥n y Evaluaci√≥n de Proyectos de Inversi√≥n Tur√≠stica"] },
            { nombre: "Agencia de Viajes", creditos: 3, ciclo: 10, prereq: ["Sistema de reservas - GDS"], area: "turisticos" },
            { nombre: "Dise√±o y equipamiento de establecimiento de hospedaje", creditos: 3, ciclo: 10, prereq: ["Sistemas operativos hoteleros"], area: "hospedaje" },
            { nombre: "Enolog√≠a y Somelier", creditos: 3, ciclo: 10, prereq: ["Bar y Cocteler√≠a"], area: "gastronomicos" },
        ];

        const iconosAreas = {
            turisticos: "üß≥",
            hospedaje: "üè®",
            gastronomicos: "üçõ"
        };

        function guardarElectivas() {
            const seleccionadas = Array.from(document.querySelectorAll('.opt:checked')).map(e => e.value);
            localStorage.setItem('electivasSeleccionadas', JSON.stringify(seleccionadas));
        }

        function cargarElectivas() {
            const guardadas = JSON.parse(localStorage.getItem('electivasSeleccionadas') || '[]');
            document.querySelectorAll('.opt').forEach(opt => {
                opt.checked = guardadas.includes(opt.value);
            });
        }

        function calcularCreditosTotales() {
            const electivas = JSON.parse(localStorage.getItem('electivasSeleccionadas') || '[]');
            return cursos.reduce((suma, curso) => {
                if (curso.area && !electivas.includes(curso.area)) return suma;
                return suma + curso.creditos;
            }, 0);
        }

        function actualizarCreditos() {
            const electivas = JSON.parse(localStorage.getItem('electivasSeleccionadas') || '[]');
            let suma = 0;
            let total = 0;

            cursos.forEach(curso => {
                // Solo contar cursos que est√°n en las √°reas seleccionadas o que no tienen √°rea
                if (curso.area && !electivas.includes(curso.area)) return;
                
                total += curso.creditos;
                
                const estado = localStorage.getItem(curso.nombre);
                if (estado === "true") {
                    suma += curso.creditos;
                }
            });
            
            const minimo = 220;
            const creditos = document.getElementById("creditos");
            const totalCreditos = document.getElementById("total-creditos");
            const extra = document.getElementById("info-extra-creditos");
            const barra = document.getElementById("barra-progreso");
            const porcentaje = document.getElementById("porcentaje");
            
            if (creditos) creditos.textContent = suma;
            if (totalCreditos) totalCreditos.textContent = total;
            if (extra) extra.textContent = `(m√≠n: ${minimo})`;
            
            const porcentajeValor = total > 0 ? Math.round((suma / total) * 100) : 0;
            if (barra) barra.style.width = `${porcentajeValor}%`;
            if (porcentaje) porcentaje.textContent = porcentajeValor;
        }

        function renderCursos() {
            const contenedor = document.getElementById("contenedor-cursos");
            contenedor.innerHTML = ''; // Limpiar contenedor
            
            const electivas = Array.from(document.querySelectorAll('.opt:checked')).map(e => e.value);
            
            const agrupados = cursos.reduce((acc, curso) => {
                // Solo incluir cursos que est√°n en las √°reas seleccionadas o que no tienen √°rea
                if (curso.area && !electivas.includes(curso.area)) return acc;
                
                if (!acc[curso.ciclo]) acc[curso.ciclo] = [];
                acc[curso.ciclo].push(curso);
                return acc;
            }, {});

            Object.keys(agrupados).sort((a, b) => a - b).forEach(ciclo => {
                const divCiclo = document.createElement("div");
                divCiclo.className = "ciclo";
                const titulo = document.createElement("h2");
                titulo.textContent = `${ciclo}¬∞ Ciclo`;
                divCiclo.appendChild(titulo);

                agrupados[ciclo].forEach(curso => {
                    const estado = localStorage.getItem(curso.nombre) === "true";
                    const prereqCumplidos = !curso.prereq || curso.prereq.every(p => localStorage.getItem(p) === "true");

                    const div = document.createElement("div");
                    div.className = "curso";
                    if (estado) div.classList.add("tildado");
                    else if (prereqCumplidos) div.classList.add("activo");
                    else div.classList.add("bloqueado");
                    if (curso.area) div.classList.add("electiva");

                    const icono = curso.area ? `${iconosAreas[curso.area]} ` : "";
                    div.textContent = icono + curso.nombre;

                    const tooltip = document.createElement("div");
                    tooltip.className = "tooltip";
                    tooltip.textContent = `Cr√©ditos: ${curso.creditos}\nPrerrequisitos: ${curso.prereq ? curso.prereq.join(', ') : 'NR'}`;
                    div.appendChild(tooltip);

                    if (div.classList.contains("activo") || div.classList.contains("tildado")) {
                        div.addEventListener("click", () => {
                            const nuevo = !(localStorage.getItem(curso.nombre) === "true");
                            localStorage.setItem(curso.nombre, nuevo);
                            renderCursos();
                            actualizarCreditos();
                        });
                    }

                    divCiclo.appendChild(div);
                });

                contenedor.appendChild(divCiclo);
            });
        }

        // Event listeners para checkboxes de electivas
        document.querySelectorAll('.opt').forEach(opt => {
            opt.addEventListener('change', () => {
                const seleccionadas = Array.from(document.querySelectorAll('.opt:checked'));
                if (seleccionadas.length > 2) {
                    opt.checked = false;
                    alert('Solo puedes elegir 2 √°reas electivas.');
                    return;
                }
                guardarElectivas();
                renderCursos();
                actualizarCreditos();
            });
        });

        // Bot√≥n reset
        document.getElementById("reset").addEventListener("click", () => {
            // Eliminar el progreso de todos los cursos
            cursos.forEach(curso => {
                localStorage.removeItem(curso.nombre);
            });
        
            // Eliminar √°reas electivas seleccionadas
            localStorage.removeItem('electivasSeleccionadas');
        
            // Destildar checkboxes de electivas
            document.querySelectorAll('.opt').forEach(opt => opt.checked = false);
        
            // Volver a cargar todo
            renderCursos();
            actualizarCreditos();
        });

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            cargarElectivas();
            renderCursos();
            actualizarCreditos();
        });
        
        // Tambi√©n ejecutar inmediatamente por si el DOM ya est√° cargado
        cargarElectivas();
        renderCursos();
        actualizarCreditos();
    </script>
</body>
</html>
